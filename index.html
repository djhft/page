<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>实时商品图册</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['"Noto Serif SC"', 'serif'],
            sans: ['Inter', 'sans-serif']
          },
          colors: {
            'bg-dark': '#1a1a1a',
            'card-bg': '#262626'
          }
        }
      }
    }
  </script>

  <style>
    body { background:#121212; color:#e5e5e5 }
    .no-scrollbar::-webkit-scrollbar{display:none}
    .no-scrollbar{scrollbar-width:none}
    .loader{
      width:24px;height:24px;border:3px solid rgba(255,255,255,.15);
      border-top:3px solid #3b82f6;border-radius:50%;
      animation:spin 1s linear infinite
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .list-item{opacity:0;transform:translateY(20px);animation:fade .6s ease forwards}
    @keyframes fade{to{opacity:1;transform:none}}
  </style>
</head>

<body class="min-h-screen pb-24">

<!-- Header -->
<header class="fixed top-0 inset-x-0 z-30 bg-bg-dark/90 backdrop-blur border-b border-white/10">
  <div class="max-w-2xl mx-auto px-5 py-4">
    <div class="flex justify-between items-center mb-3">
      <h1 class="font-serif text-xl font-bold">MY PRODUCTS</h1>
      <div class="flex items-center gap-2 text-xs text-gray-400 font-mono">
        <span id="loading" class="loader hidden"></span>
        <span id="status">READY</span>
      </div>
    </div>
    <div class="flex gap-2 flex-wrap">
      <button id="btn-all" class="px-3 py-1 text-xs rounded-full bg-blue-600 text-white">全部商品</button>
      <div id="category-filters" class="flex gap-2 flex-wrap"></div>
    </div>
  </div>
</header>

<div class="h-20"></div>

<!-- Main -->
<main class="max-w-2xl mx-auto px-4">
  <div id="product-list" class="space-y-10"></div>

  <div id="error" class="hidden text-center py-20 text-gray-400">
    <i class="fa-solid fa-triangle-exclamation text-4xl text-red-500 mb-4"></i>
    <p>商品加载失败，请检查 products.json</p>
  </div>
</main>

<!-- Viewer -->
<div id="viewer" class="fixed inset-0 hidden z-50 bg-black flex items-center justify-center">
  <button onclick="closeViewer()" class="absolute top-6 right-6 w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 text-white">
    <i class="fa-solid fa-xmark"></i>
  </button>
  <img id="viewer-img" class="max-w-full max-h-full object-contain select-none">
</div>

<script>
/* ================= 配置 ================= */
const OWNER = "panzetao";
const REPO  = "image-bed";
const FILE  = "image/products.json";

/* jsDelivr Gitee 镜像（无 CORS） */
const DATA_URL = `https://cdn.jsdelivr.net/gh/${OWNER}/${REPO}@master/${FILE}`;

/* ================= 状态 ================= */
let products = [];
let currentCategory = null;

/* ================= DOM ================= */
const listEl = document.getElementById("product-list");
const statusEl = document.getElementById("status");
const loadingEl = document.getElementById("loading");
const errorEl = document.getElementById("error");
const catEl = document.getElementById("category-filters");
const allBtn = document.getElementById("btn-all");
const viewer = document.getElementById("viewer");
const viewerImg = document.getElementById("viewer-img");

/* ================= 数据 ================= */
async function fetchProducts(){
  loadingEl.classList.remove("hidden");
  statusEl.textContent = "LOADING";
  errorEl.classList.add("hidden");

  try{
    const res = await fetch(DATA_URL, { cache:"no-store" });
    if(!res.ok) throw new Error(res.status);
    const data = await res.json();
    if(!Array.isArray(data)) throw "products.json 必须是数组";

    products = data;
    renderCategories();
    renderList();
    statusEl.textContent = `${products.length} ITEMS`;
  }catch(e){
    console.error(e);
    statusEl.textContent = "ERROR";
    errorEl.classList.remove("hidden");
  }finally{
    loadingEl.classList.add("hidden");
  }
}

/* ================= 分类 ================= */
function renderCategories(){
  const cats = [...new Set(products.map(p=>p.category).filter(Boolean))];
  catEl.innerHTML = cats.map(c=>`
    <button class="px-3 py-1 text-xs rounded-full bg-gray-700 text-gray-300"
      onclick="filterCategory('${c}')">${c}</button>
  `).join("");
}

function filterCategory(cat){
  currentCategory = cat;
  renderList();
}

allBtn.onclick = () => {
  currentCategory = null;
  renderList();
}

/* ================= 列表 ================= */
function renderList(){
  const list = currentCategory
    ? products.filter(p=>p.category===currentCategory)
    : products;

  listEl.innerHTML = list.map((p,i)=>`
    <div class="list-item" style="animation-delay:${i*80}ms">
      <div class="aspect-[4/3] rounded-2xl overflow-hidden bg-card-bg cursor-pointer"
        onclick="openViewer('${p.images?.[0]?.url || ""}')">
        <img src="${p.images?.[0]?.url || ""}" class="w-full h-full object-cover">
      </div>
      <div class="mt-3 flex justify-between gap-4">
        <div>
          <h3 class="font-serif font-bold text-lg">${p.name || "未命名商品"}</h3>
          <p class="text-xs text-gray-500 mt-1">${p.description || ""}</p>
        </div>
        <span class="text-3xl font-bold text-blue-400">¥${p.price || 0}</span>
      </div>
    </div>
  `).join("");
}

/* ================= 查看器 ================= */
function openViewer(url){
  if(!url) return;
  viewerImg.src = url;
  viewer.classList.remove("hidden");
  document.body.style.overflow = "hidden";
}

function closeViewer(){
  viewer.classList.add("hidden");
  viewerImg.src = "";
  document.body.style.overflow = "";
}

viewer.onclick = e=>{
  if(e.target===viewer) closeViewer();
}

/* ================= 启动 ================= */
fetchProducts();
</script>

</body>
</html>
